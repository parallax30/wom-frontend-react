{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/francico/Documents/code/wom-frontend-react/src/app/api/login/route.ts"],"sourcesContent":["import { cookies } from 'next/headers';\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const identifier = body.identifier ?? body.email;\n    const password = body.password;\n\n    if (!identifier || !password) {\n      return new Response(JSON.stringify({ error: 'Missing credentials' }), { status: 400 });\n    }\n\n    const base = process.env.NEXT_PUBLIC_STRAPI_URL;\n    console.log('Strapi base URL:', base);\n    if (!base) {\n      console.error('[app/api/login] NEXT_PUBLIC_STRAPI_URL not set');\n      return new Response(JSON.stringify({ error: 'Server not configured' }), { status: 500 });\n    }\n\n    \n    const url = `${base}/api/auth/local`;\n    console.log('url :', url);\n    const res = await fetch(url, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ identifier, password }),\n    });\n\n    console.log('Response from Strapi:', res);\n\n    let data: any = null;\n    try {\n      data = await res.json();\n    } catch (e) {\n      const txt = await res.text();\n      console.error('[app/api/login] Non-JSON response from Strapi:', txt);\n      return new Response(JSON.stringify({ error: 'Authentication service error' }), { status: 502 });\n    }\n\n    if (!res.ok) {\n      return new Response(JSON.stringify({ error: data?.error?.message ?? 'Invalid credentials' }), { status: 401 });\n    }\n\n    try {\n      (await cookies()).set('strapi-jwt', data.jwt, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/',\n      });\n    } catch (e) {\n      console.error('[app/api/login] Failed to set cookie', e);\n      return new Response(JSON.stringify({ error: 'Failed to set auth cookie' }), { status: 500 });\n    }\n\n    return new Response(JSON.stringify({ user: data.user }), { status: 200, headers: { 'Content-Type': 'application/json' } });\n  } catch (error) {\n    console.error('[app/api/login] error', error);\n    return new Response(JSON.stringify({ error: 'Login failed' }), { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;AAAA;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,aAAa,KAAK,UAAU,IAAI,KAAK,KAAK;QAChD,MAAM,WAAW,KAAK,QAAQ;QAE9B,IAAI,CAAC,cAAc,CAAC,UAAU;YAC5B,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsB,IAAI;gBAAE,QAAQ;YAAI;QACtF;QAEA,MAAM;QACN,QAAQ,GAAG,CAAC,oBAAoB;QAChC,uCAAW;;QAGX;QAGA,MAAM,MAAM,GAAG,KAAK,eAAe,CAAC;QACpC,QAAQ,GAAG,CAAC,SAAS;QACrB,MAAM,MAAM,MAAM,MAAM,KAAK;YAC3B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAY;YAAS;QAC9C;QAEA,QAAQ,GAAG,CAAC,yBAAyB;QAErC,IAAI,OAAY;QAChB,IAAI;YACF,OAAO,MAAM,IAAI,IAAI;QACvB,EAAE,OAAO,GAAG;YACV,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,QAAQ,KAAK,CAAC,kDAAkD;YAChE,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA+B,IAAI;gBAAE,QAAQ;YAAI;QAC/F;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO,MAAM,OAAO,WAAW;YAAsB,IAAI;gBAAE,QAAQ;YAAI;QAC9G;QAEA,IAAI;YACF,CAAC,MAAM,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,cAAc,KAAK,GAAG,EAAE;gBAC5C,UAAU;gBACV,QAAQ,oDAAyB;gBACjC,UAAU;gBACV,MAAM;YACR;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,wCAAwC;YACtD,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA4B,IAAI;gBAAE,QAAQ;YAAI;QAC5F;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,MAAM,KAAK,IAAI;QAAC,IAAI;YAAE,QAAQ;YAAK,SAAS;gBAAE,gBAAgB;YAAmB;QAAE;IAC1H,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAe,IAAI;YAAE,QAAQ;QAAI;IAC/E;AACF","debugId":null}}]
}